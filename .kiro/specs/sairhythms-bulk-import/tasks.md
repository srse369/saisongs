# Implementation Plan

- [x] 1. Set up environment configuration for admin password
  - Add `VITE_ADMIN_PASSWORD` to `.env.local.template` with placeholder value
  - Document the password configuration in README or admin documentation
  - _Requirements: 1.4_

- [x] 2. Create password validation utilities
  - [x] 2.1 Implement password validation function
    - Create utility function to validate password against environment variable
    - Handle missing environment variable case
    - _Requirements: 1.2, 1.4_
  - [x] 2.2 Implement rate limiting logic
    - Create rate limiter to track failed attempts
    - Implement 5-minute lockout after 5 failed attempts
    - Store attempt count and lockout timestamp in component state
    - _Requirements: 1.5_

- [x] 3. Implement keyboard shortcut handler
  - [x] 3.1 Create useAdminShortcut hook
    - Listen for Ctrl+Shift+I (Windows/Linux) or Cmd+Shift+I (Mac)
    - Prevent default browser behavior
    - Manage password dialog open/close state
    - _Requirements: 6.2_
  - [x] 3.2 Integrate keyboard shortcut into App component
    - Add keyboard event listener at app level
    - Ensure shortcut works globally in admin context
    - _Requirements: 6.1, 6.2_

- [x] 4. Build Password Dialog component
  - [x] 4.1 Create PasswordDialog component structure
    - Build modal dialog with password input field
    - Add submit and cancel buttons
    - Implement focus management for accessibility
    - _Requirements: 1.1, 1.2_
  - [x] 4.2 Implement password validation in dialog
    - Connect to password validation utility
    - Display error messages for incorrect passwords
    - Handle rate limiting UI (disable input during lockout)
    - Clear password field on close
    - _Requirements: 1.2, 1.3, 1.5_
  - [x] 4.3 Add success callback to open Import UI
    - Trigger Import UI on successful authentication
    - Close password dialog on success
    - _Requirements: 1.3_

- [x] 5. Create Sairhythms Scraper Service
  - [x] 5.1 Implement basic scraper service structure
    - Create `SairhythmsScraperService.ts` file
    - Define `DiscoveredSong` interface
    - Implement service class with singleton export
    - _Requirements: 2.1_
  - [x] 5.2 Implement song discovery logic
    - Fetch HTML from sairhythms.org main page or song index
    - Parse HTML using DOMParser to extract song links
    - Look for patterns like `/song/` or `/songs/` in URLs
    - Extract song names from link text or title attributes
    - _Requirements: 2.1, 2.2_
  - [x] 5.3 Implement URL validation and normalization
    - Validate URLs match sairhythms.org domain
    - Convert relative URLs to absolute URLs
    - Remove duplicate URLs
    - _Requirements: 2.4_
  - [x] 5.4 Add error handling and retry logic
    - Implement exponential backoff retry for network errors (up to 3 attempts)
    - Handle parse errors gracefully and return partial results
    - Log errors for debugging
    - _Requirements: 2.3, 5.1_

- [x] 6. Create Import Service
  - [x] 6.1 Implement basic import service structure
    - Create `ImportService.ts` file
    - Define `ImportProgress`, `ImportError`, and `ImportResult` interfaces
    - Implement service class with singleton export
    - _Requirements: 4.1, 4.2, 4.3_
  - [x] 6.2 Implement song matching logic
    - Fetch all existing songs from database
    - Create lookup maps by URL and name (case-insensitive)
    - Match discovered songs by URL first, then by name
    - _Requirements: 3.1, 3.2_
  - [x] 6.3 Implement import processing loop
    - Iterate through discovered songs
    - For each song, determine if it exists (update) or is new (create)
    - Call appropriate SongService method (updateSong or createSong)
    - Update progress statistics after each song
    - _Requirements: 3.1, 3.2, 3.3, 3.4_
  - [x] 6.4 Implement progress reporting
    - Call onProgress callback after each song with updated statistics
    - Include current song name in progress updates
    - _Requirements: 4.1, 4.2_
  - [x] 6.5 Implement error collection
    - Wrap each song operation in try-catch
    - Collect errors without stopping import process
    - Include song name and error message in error collection
    - _Requirements: 4.3, 5.2, 5.3_
  - [x] 6.6 Return final import result
    - Compile final statistics (total, created, updated, failed)
    - Return success status and error list
    - _Requirements: 4.4_

- [x] 7. Build Bulk Import UI component
  - [x] 7.1 Create BulkImportUI component structure
    - Create modal component for import interface
    - Define component state for import status and progress
    - Add Start Import button for idle state
    - _Requirements: 4.1, 4.2_
  - [x] 7.2 Implement progress display
    - Add progress bar showing percentage complete
    - Display real-time statistics (processed, created, updated, failed)
    - Show current song being processed
    - _Requirements: 4.1, 4.2, 4.3_
  - [x] 7.3 Implement import execution
    - Call ImportService.importAllSongs on button click
    - Update component state with progress callbacks
    - Handle import completion and errors
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  - [x] 7.4 Add completion summary display
    - Show final statistics when import completes
    - Display collapsible error list if errors occurred
    - Add close button (disabled during import)
    - _Requirements: 4.4, 4.5_
  - [x] 7.5 Add error display for critical failures
    - Handle and display critical errors (network failure, etc.)
    - Provide clear error messages to administrator
    - _Requirements: 5.5_

- [x] 8. Integrate all components
  - [x] 8.1 Wire up keyboard shortcut to password dialog
    - Connect useAdminShortcut hook to PasswordDialog component
    - Ensure dialog opens on keyboard shortcut
    - _Requirements: 6.2_
  - [x] 8.2 Wire up password dialog to import UI
    - Pass success callback from PasswordDialog to BulkImportUI
    - Ensure Import UI opens after successful authentication
    - _Requirements: 1.3_
  - [x] 8.3 Connect Import UI to Import Service
    - Call ImportService from BulkImportUI component
    - Pass progress callback to update UI state
    - Handle import results and errors
    - _Requirements: 4.1, 4.2, 4.3, 4.4_
  - [x] 8.4 Refresh song list after import
    - Trigger song context refresh after successful import
    - Ensure UI reflects newly imported songs
    - _Requirements: 3.3, 3.4_

- [x] 9. Add documentation
  - [x] 9.1 Document keyboard shortcut in admin guide
    - Create or update admin documentation with shortcut instructions
    - Document password configuration steps
    - _Requirements: 6.3_
  - [x] 9.2 Add code comments and JSDoc
    - Document all service methods with JSDoc comments
    - Add inline comments for complex logic
    - _Requirements: 6.3_

- [x] 10. Testing and validation
  - [x] 10.1 Test password authentication flow
    - Verify correct password grants access
    - Verify incorrect password shows error
    - Verify rate limiting after 5 attempts
    - _Requirements: 1.2, 1.3, 1.5_
  - [x] 10.2 Test scraper service with mock data
    - Create mock HTML responses
    - Verify song extraction logic
    - Test error handling for malformed HTML
    - _Requirements: 2.1, 2.2, 2.3_
  - [x] 10.3 Test import service logic
    - Test song matching by URL and name
    - Verify ID preservation for existing songs
    - Verify new song creation
    - Test error collection
    - _Requirements: 3.1, 3.2, 3.3, 3.4, 5.2, 5.3_
  - [x] 10.4 Perform end-to-end manual testing
    - Test complete flow from keyboard shortcut to import completion
    - Verify database state after import
    - Test with various scenarios (all new songs, all existing, mixed)
    - _Requirements: All_
